{% load cloudinary %}
{% load endless %}
{% load bootstrap %}
{% paginate resources %}
{% for resource in resources %}
<div class="feed">
    <div class="profile-img">
        {% if resource.author.profile.image %}
             {% cloudinary resource.author.profile.image width=70 height=70 crop="fill" %}
        {% else %}
            {% cloudinary "vqr7n59zfxyeybttleug.gif" width=64 height=64 crop="fill" %}
        {% endif %}
    </div>
    <div class="feed-content">
        <p class="poster-details">
            <a href="/user/{{ resource.author }}">{{ resource.author }}</a> -
            <small>{{ resource.date_added | timesince }} ago</small>
        </p>
        <h1>{{ resource.text }}</h1>

        {% if resource.snippet_text %}
        <p>
            <pre class="prettyprint linenums">{{ resource.snippet_text }}</pre>
        </p>
        {% endif %}

        {% if resource.resource_file %}
        <p id="file-icon">
        {% if resource.resource_file.format == "pdf" %}
        <i id="file-icon-pdf" class="mdi mdi-file-pdf"></i>
        {% else %}
        <i id="file-icon-doc" class="mdi mdi-file-word"></i>
        {% endif %}
        </p> &nbsp;
        <p id="file-info">
        <a href="http://res.cloudinary.com/codangofile/raw/upload/{{ resource.resource_file }}.{{ resource.resource_file.format }}">{{ resource.resource_file_name }}</a><br>
        size: {{ resource.resource_file_size|filesizeformat }}
        </p>
        {% endif %}



        <div class="row">
            <div class="col-sm-6">
                <div class="codango-badge">{{ resource.get_language_tags_display }}</div>
            </div>
            <div class="col-sm-6">
                <span class="pull-right mdi mdi-comment item">{{ resource.comments.count }}</span>
                {% if request.user.id in resource.upvotes %}
                <a href="{% url 'vote' resource_id=resource.id action='unlike' %}" data-id="{{resource.id}}" class="unlike"><span class="pull-right mdi mdi-thumb-down item">{{resource.downvotes|length}}</span></a>

                <a href="{% url 'vote' resource_id=resource.id action='like' %}" data-id="{{resource.id}}" class="like"><span class="pull-right mdi mdi-thumb-up active item" >{{resource.upvotes|length}}</span></a>
                {% elif request.user.id in resource.downvotes %}
                <a href="{% url 'vote' resource_id=resource.id action='unlike' %}" data-id="{{resource.id}}" class="unlike"><span class="pull-right mdi mdi-thumb-down active item">{{resource.downvotes|length}}</span></a>
                <a href="{% url 'vote' resource_id=resource.id action='like' %}" data-id="{{resource.id}}" class="like"><span class="pull-right mdi mdi-thumb-up item" >{{resource.upvotes|length}}</span></a>
                {% else  %}
                <a href="{% url 'vote' resource_id=resource.id action='unlike' %}" data-id="{{resource.id}}" class="unlike"><span class="pull-right mdi mdi-thumb-down item">{{resource.downvotes|length}}</span></a>
                <a href="{% url 'vote' resource_id=resource.id action='like' %}" data-id="{{resource.id}}" class="like"><span class="pull-right mdi mdi-thumb-up item" >{{resource.upvotes|length}}</span></a>
                {% endif %}
                 
                
            </div>
        </div>
        <div class="comments-div">
        <form name="comment_form" class="form-horizontal commentform" action="{% url 'newcomment' %}" method="POST">
        {% csrf_token %}
        <input type="hidden" name="resource_id" value="{{resource.id}}">
        {{ commentform|bootstrap }}
        <button class="pull-right btn btn-sm btn-primary" type="submit"> Comment </button>
        
        </form>
        <div class="comments" id="rcomments-{{resource.id}}">
        {% for comment in resource.comments.all %}

        <article class="row">
            <div class="col-md-2 col-sm-2 hidden-xs">
              <figure class="thumbnail">
        {% if comment.author.profile.image %}
             {% cloudinary comment.author.profile.image width=70 height=70 crop="fill" %}
        {% else %}
            {% cloudinary "vqr7n59zfxyeybttleug.gif" width=64 height=64 crop="fill" %}
        {% endif %}
              </figure>
            </div>
            <div class="col-md-10 col-sm-10">
              <div class="panel panel-default arrow left">
                <div class="panel-body">
                  <header class="text-left">
                    <div class="comment-user"><i class="mdi mdi-account"></i> {{comment.author}}</div>
                     <time class="comment-date" datetime="16-12-2014 01:05"><i class="mdi mdi-alarm"></i> {{comment.date_created|timesince}} ago </time>
                  </header>
                  </header>
                 <div class="comment-post">
                    <p>
                     {{comment}}
                    </p>
                  </div>
                  {% if comment.author.id == request.user.id %}
                  <p class="text-right"><a href="{% url 'comment' comment_id=comment.id action='delete' %}" class="btn btn-default btn-sm delete-comment">Delete</a></p>
                  {% endif %}
                </div>
              </div>
            </div>
          </article>
          {% empty %}
        <p class="alert alert-info spacers"> There are currently no comments for this resource </p>

        {% endfor %}
        </div>
    </div>
</div>
</div>
{% empty %}
<div class="alert alert-info spacer">There are currently no posts</div>
{% endfor %}
{% show_more %}

<script type="text/javascript">
prettyPrint();
</script>